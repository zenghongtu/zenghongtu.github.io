{"data":{"post":{"id":"6ac32379-a385-5861-81c6-af4059a4d2b5","html":"<p>title: 破解Geetest极验滑动验证码\nauthor: 大图\ntags:</p>\n<ul>\n<li>python</li>\n<li>验证码\ncategories:</li>\n<li>\n<p>爬虫\ndate: 2017-12-25 14:22:00</p>\n<hr>\n</li>\n<li>截取验证码直接获取验证码图片实现起来比较麻烦，因此这里采用 selenium 截图的方式截取验证码图片。鼠标左键点击滑动条时，验证码会显示出来，此时通过 get<em>screenshot</em>as_png 方法将页面截取下来，再通过验证码在页面中的位置，将验证码截取出来。代码如下：</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">get_captcha_img</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    slider_element<span class=\"token operator\">=</span>self<span class=\"token punctuation\">.</span>browser<span class=\"token punctuation\">.</span>find_element_by_class_name<span class=\"token punctuation\">(</span><span class=\"token string\">'gt_slider_knob'</span><span class=\"token punctuation\">)</span>\n    item<span class=\"token operator\">=</span>self<span class=\"token punctuation\">.</span>browser<span class=\"token punctuation\">.</span>find_element_by_class_name<span class=\"token punctuation\">(</span><span class=\"token string\">'gt_box'</span><span class=\"token punctuation\">)</span>\n    self<span class=\"token punctuation\">.</span>action<span class=\"token punctuation\">.</span>click_and_hold<span class=\"token punctuation\">(</span>on_element<span class=\"token operator\">=</span>slider_element<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>perform<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    time<span class=\"token punctuation\">.</span>sleep<span class=\"token punctuation\">(</span><span class=\"token number\">0.3</span><span class=\"token punctuation\">)</span>\n    screenshot<span class=\"token operator\">=</span>self<span class=\"token punctuation\">.</span>browser<span class=\"token punctuation\">.</span>get_screenshot_as_png<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    left <span class=\"token operator\">=</span> item<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">[</span><span class=\"token string\">'x'</span><span class=\"token punctuation\">]</span>\n    right <span class=\"token operator\">=</span> left <span class=\"token operator\">+</span> item<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">[</span><span class=\"token string\">'width'</span><span class=\"token punctuation\">]</span>\n    top <span class=\"token operator\">=</span> item<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">[</span><span class=\"token string\">'y'</span><span class=\"token punctuation\">]</span>\n    bottom <span class=\"token operator\">=</span> top <span class=\"token operator\">+</span> item<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">[</span><span class=\"token string\">'height'</span><span class=\"token punctuation\">]</span>\n    img<span class=\"token operator\">=</span>Image<span class=\"token punctuation\">.</span><span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span>BytesIO<span class=\"token punctuation\">(</span>screenshot<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    captcha<span class=\"token operator\">=</span>img<span class=\"token punctuation\">.</span>crop<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>left<span class=\"token punctuation\">,</span>top<span class=\"token punctuation\">,</span>right<span class=\"token punctuation\">,</span>bottom<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> captcha</code></pre></div>\n<ol start=\"2\">\n<li>计算滑动位置拼图的位置是一块阴影，设定一个阈值，将图片二值化，可以计算出拼图凹槽的位置。</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">cal_slider_offset</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    captcha<span class=\"token operator\">=</span>self<span class=\"token punctuation\">.</span>get_captcha_img<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    image<span class=\"token operator\">=</span>captcha<span class=\"token punctuation\">.</span>convert<span class=\"token punctuation\">(</span><span class=\"token string\">'L'</span><span class=\"token punctuation\">)</span>\n    flag<span class=\"token operator\">=</span><span class=\"token number\">0</span>\n    <span class=\"token keyword\">for</span> x <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">60</span><span class=\"token punctuation\">,</span>image<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        sum_pix<span class=\"token operator\">=</span><span class=\"token number\">0</span>\n        <span class=\"token keyword\">for</span> y <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            pix<span class=\"token operator\">=</span>image<span class=\"token punctuation\">.</span>getpixel<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span>y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">if</span> pix<span class=\"token operator\">&lt;</span><span class=\"token number\">55</span><span class=\"token punctuation\">:</span>\n                sum_pix<span class=\"token operator\">+=</span><span class=\"token number\">1</span>\n        <span class=\"token keyword\">if</span> sum_pix<span class=\"token operator\">></span>self<span class=\"token punctuation\">.</span>threshold<span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">return</span> x<span class=\"token operator\">-</span>flag\n        <span class=\"token keyword\">if</span> sum_pix<span class=\"token operator\">==</span><span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\n            flag<span class=\"token operator\">=</span><span class=\"token number\">0</span>\n        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n            flag<span class=\"token operator\">+=</span><span class=\"token number\">1</span>\n        <span class=\"token keyword\">if</span> flag<span class=\"token operator\">></span><span class=\"token number\">3</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">return</span> x<span class=\"token operator\">-</span>flag\n    <span class=\"token keyword\">return</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span></code></pre></div>\n<ol start=\"3\">\n<li>模拟轨迹，滑动认证\nGeetest 通过滑动的轨迹来判断是不是真人操作，因此滑动要尽量模拟人的操作。下面的方法只是简单地模拟了一下，“被怪物吃掉”的概率较大。如果需要更高的通过率，可以采集自己鼠标滑动的轨迹数据来认证。</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">get_track</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span>offset<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    line<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">while</span> offset<span class=\"token operator\">></span><span class=\"token number\">5</span><span class=\"token punctuation\">:</span>\n        num<span class=\"token operator\">=</span>random<span class=\"token punctuation\">.</span>randint<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span>\n        line<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>num<span class=\"token punctuation\">)</span>\n        offset<span class=\"token operator\">-=</span>num\n    <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>offset<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        line<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> line\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">drag_and_drop_by_offset</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span>offset<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    element<span class=\"token operator\">=</span>self<span class=\"token punctuation\">.</span>browser<span class=\"token punctuation\">.</span>find_element_by_class_name<span class=\"token punctuation\">(</span><span class=\"token string\">'gt_slider_knob'</span><span class=\"token punctuation\">)</span>\n    line<span class=\"token operator\">=</span>self<span class=\"token punctuation\">.</span>get_track<span class=\"token punctuation\">(</span>offset<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">for</span> x <span class=\"token keyword\">in</span> line<span class=\"token punctuation\">:</span>\n        self<span class=\"token punctuation\">.</span>action<span class=\"token punctuation\">.</span>move_by_offset<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span>random<span class=\"token punctuation\">.</span>randint<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>perform<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>action<span class=\"token punctuation\">.</span>reset_actions<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        time<span class=\"token punctuation\">.</span>sleep<span class=\"token punctuation\">(</span>random<span class=\"token punctuation\">.</span>randint<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token operator\">/</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span>\n    self<span class=\"token punctuation\">.</span>action<span class=\"token punctuation\">.</span>release<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>perform<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    time<span class=\"token punctuation\">.</span>sleep<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n    gt_info_text<span class=\"token operator\">=</span>self<span class=\"token punctuation\">.</span>browser<span class=\"token punctuation\">.</span>find_element_by_class_name<span class=\"token punctuation\">(</span><span class=\"token string\">'gt_info_text'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>text\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>gt_info_text<span class=\"token punctuation\">)</span>\n    screenshot<span class=\"token operator\">=</span>self<span class=\"token punctuation\">.</span>browser<span class=\"token punctuation\">.</span>get_screenshot_as_png<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    img<span class=\"token operator\">=</span>Image<span class=\"token punctuation\">.</span><span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span>BytesIO<span class=\"token punctuation\">(</span>screenshot<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    img<span class=\"token punctuation\">.</span>show<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ol start=\"4\">\n<li>完整代码</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> requests\n<span class=\"token keyword\">from</span> selenium <span class=\"token keyword\">import</span> webdriver\n<span class=\"token keyword\">from</span> selenium<span class=\"token punctuation\">.</span>webdriver<span class=\"token punctuation\">.</span>common<span class=\"token punctuation\">.</span>action_chains <span class=\"token keyword\">import</span> ActionChains\n<span class=\"token keyword\">import</span> time\n<span class=\"token keyword\">import</span> logging\n<span class=\"token keyword\">from</span> PIL <span class=\"token keyword\">import</span> Image\n<span class=\"token keyword\">from</span> io <span class=\"token keyword\">import</span> BytesIO\n<span class=\"token keyword\">import</span> random\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">HackGeetest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        self<span class=\"token punctuation\">.</span>browser<span class=\"token operator\">=</span>webdriver<span class=\"token punctuation\">.</span>PhantomJS<span class=\"token punctuation\">(</span><span class=\"token string\">'./phantomjs'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">#self.browser=webdriver.Chrome('./chromedriver')</span>\n        self<span class=\"token punctuation\">.</span>browser<span class=\"token punctuation\">.</span>maximize_window<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>browser<span class=\"token punctuation\">.</span>implicitly_wait<span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>action<span class=\"token operator\">=</span>ActionChains<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>browser<span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>threshold<span class=\"token operator\">=</span><span class=\"token number\">10</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">get_captcha_img</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        slider_element<span class=\"token operator\">=</span>self<span class=\"token punctuation\">.</span>browser<span class=\"token punctuation\">.</span>find_element_by_class_name<span class=\"token punctuation\">(</span><span class=\"token string\">'gt_slider_knob'</span><span class=\"token punctuation\">)</span>\n        item<span class=\"token operator\">=</span>self<span class=\"token punctuation\">.</span>browser<span class=\"token punctuation\">.</span>find_element_by_class_name<span class=\"token punctuation\">(</span><span class=\"token string\">'gt_box'</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>action<span class=\"token punctuation\">.</span>click_and_hold<span class=\"token punctuation\">(</span>on_element<span class=\"token operator\">=</span>slider_element<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>perform<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        time<span class=\"token punctuation\">.</span>sleep<span class=\"token punctuation\">(</span><span class=\"token number\">0.3</span><span class=\"token punctuation\">)</span>\n        screenshot<span class=\"token operator\">=</span>self<span class=\"token punctuation\">.</span>browser<span class=\"token punctuation\">.</span>get_screenshot_as_png<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        left <span class=\"token operator\">=</span> item<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">[</span><span class=\"token string\">'x'</span><span class=\"token punctuation\">]</span>\n        right <span class=\"token operator\">=</span> left <span class=\"token operator\">+</span> item<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">[</span><span class=\"token string\">'width'</span><span class=\"token punctuation\">]</span>\n        top <span class=\"token operator\">=</span> item<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">[</span><span class=\"token string\">'y'</span><span class=\"token punctuation\">]</span>\n        bottom <span class=\"token operator\">=</span> top <span class=\"token operator\">+</span> item<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">[</span><span class=\"token string\">'height'</span><span class=\"token punctuation\">]</span>\n        img<span class=\"token operator\">=</span>Image<span class=\"token punctuation\">.</span><span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span>BytesIO<span class=\"token punctuation\">(</span>screenshot<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        captcha<span class=\"token operator\">=</span>img<span class=\"token punctuation\">.</span>crop<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>left<span class=\"token punctuation\">,</span>top<span class=\"token punctuation\">,</span>right<span class=\"token punctuation\">,</span>bottom<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> captcha\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">cal_slider_offset</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        captcha<span class=\"token operator\">=</span>self<span class=\"token punctuation\">.</span>get_captcha_img<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        captcha<span class=\"token punctuation\">.</span>show<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        image<span class=\"token operator\">=</span>captcha<span class=\"token punctuation\">.</span>convert<span class=\"token punctuation\">(</span><span class=\"token string\">'L'</span><span class=\"token punctuation\">)</span>\n        flag<span class=\"token operator\">=</span><span class=\"token number\">0</span>\n        <span class=\"token keyword\">for</span> x <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">60</span><span class=\"token punctuation\">,</span>image<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            sum_pix<span class=\"token operator\">=</span><span class=\"token number\">0</span>\n            <span class=\"token keyword\">for</span> y <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n                pix<span class=\"token operator\">=</span>image<span class=\"token punctuation\">.</span>getpixel<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span>y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token keyword\">if</span> pix<span class=\"token operator\">&lt;</span><span class=\"token number\">55</span><span class=\"token punctuation\">:</span>\n                    sum_pix<span class=\"token operator\">+=</span><span class=\"token number\">1</span>\n            <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span>sum_pix<span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">if</span> sum_pix<span class=\"token operator\">></span>self<span class=\"token punctuation\">.</span>threshold<span class=\"token punctuation\">:</span>\n                <span class=\"token keyword\">return</span> x<span class=\"token operator\">-</span>flag\n            <span class=\"token keyword\">if</span> sum_pix<span class=\"token operator\">==</span><span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\n                flag<span class=\"token operator\">=</span><span class=\"token number\">0</span>\n            <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n                flag<span class=\"token operator\">+=</span><span class=\"token number\">1</span>\n            <span class=\"token keyword\">if</span> flag<span class=\"token operator\">></span><span class=\"token number\">4</span><span class=\"token punctuation\">:</span>\n                <span class=\"token keyword\">return</span> x<span class=\"token operator\">-</span>flag\n        <span class=\"token keyword\">return</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">load_page</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        self<span class=\"token punctuation\">.</span>browser<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">get_track</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span>offset<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        line<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n        <span class=\"token keyword\">while</span> offset<span class=\"token operator\">></span><span class=\"token number\">5</span><span class=\"token punctuation\">:</span>\n            num<span class=\"token operator\">=</span>random<span class=\"token punctuation\">.</span>randint<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span>\n            line<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>num<span class=\"token punctuation\">)</span>\n            offset<span class=\"token operator\">-=</span>num\n        <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>offset<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            line<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> line\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">drag_and_drop_by_offset</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span>offset<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        element<span class=\"token operator\">=</span>self<span class=\"token punctuation\">.</span>browser<span class=\"token punctuation\">.</span>find_element_by_class_name<span class=\"token punctuation\">(</span><span class=\"token string\">'gt_slider_knob'</span><span class=\"token punctuation\">)</span>\n        line<span class=\"token operator\">=</span>self<span class=\"token punctuation\">.</span>get_track<span class=\"token punctuation\">(</span>offset<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">for</span> x <span class=\"token keyword\">in</span> line<span class=\"token punctuation\">:</span>\n            self<span class=\"token punctuation\">.</span>action<span class=\"token punctuation\">.</span>move_by_offset<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span>random<span class=\"token punctuation\">.</span>randint<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>perform<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            self<span class=\"token punctuation\">.</span>action<span class=\"token punctuation\">.</span>reset_actions<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            time<span class=\"token punctuation\">.</span>sleep<span class=\"token punctuation\">(</span>random<span class=\"token punctuation\">.</span>randint<span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">,</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token operator\">/</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>action<span class=\"token punctuation\">.</span>release<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>perform<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        time<span class=\"token punctuation\">.</span>sleep<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n        screenshot<span class=\"token operator\">=</span>self<span class=\"token punctuation\">.</span>browser<span class=\"token punctuation\">.</span>get_screenshot_as_png<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">#结果</span>\n        img<span class=\"token operator\">=</span>Image<span class=\"token punctuation\">.</span><span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span>BytesIO<span class=\"token punctuation\">(</span>screenshot<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        img<span class=\"token punctuation\">.</span>show<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">quit</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        self<span class=\"token punctuation\">.</span>browser<span class=\"token punctuation\">.</span>quit<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">if</span> __name__<span class=\"token operator\">==</span><span class=\"token string\">'__main__'</span><span class=\"token punctuation\">:</span>\n    geetest<span class=\"token operator\">=</span>HackGeetest<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    geetest<span class=\"token punctuation\">.</span>load_page<span class=\"token punctuation\">(</span><span class=\"token string\">'...'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">#url</span>\n    time<span class=\"token punctuation\">.</span>sleep<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n    offset<span class=\"token operator\">=</span>geetest<span class=\"token punctuation\">.</span>cal_slider_offset<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> offset<span class=\"token operator\">!=</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span>\n        geetest<span class=\"token punctuation\">.</span>drag_and_drop_by_offset<span class=\"token punctuation\">(</span>offset<span class=\"token operator\">-</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span>\n        time<span class=\"token punctuation\">.</span>sleep<span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span>\n        geetest<span class=\"token punctuation\">.</span>quit<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>","fields":{"slug":"/破解Geetest极验滑动验证码/","prefix":null},"frontmatter":{"title":"","author":null,"category":null,"cover":null}},"authornote":{"id":"f3ffdeef-a16f-507d-9f2f-98fa5e045d0b","html":"<p><strong>Mr. Gatsby</strong> Proin ornare ligula eu tellus tempus elementum. Aenean <a href=\"/\">bibendum</a> iaculis mi, nec blandit lacus interdum vitae. Vestibulum non nibh risus, a scelerisque purus. Blandit lacus interdum vitae. Vestibulum non nibh risus, a scelerisque purus.</p>"},"site":{"siteMetadata":{"facebook":{"appId":""}}}},"pageContext":{"slug":"/破解Geetest极验滑动验证码/","prev":{"id":"d3d3818a-fa79-50ac-bd1e-1b8074190fbd","fields":{"slug":"/破解某网站url加密/","prefix":null,"source":"posts"},"frontmatter":{"title":"","category":null}},"next":{"id":"289462f0-6a16-5122-ac92-e4b1dbd96226","fields":{"slug":"/一个很好的epoll解析/","prefix":null,"source":"posts"},"frontmatter":{"title":"","category":null}},"source":"posts"}}