{"data":{"post":{"id":"2e98a99f-71d6-58d4-a402-6f1a94c91bd0","html":"<blockquote>\n<p>æ—©ä¸Šåƒæ—©é¤è¾¹é€›æ˜é‡‘çš„æ—¶å€™çœ‹åˆ°ä¸€ä¸ªé¢è¯•é¢˜ï¼Œçœ‹ä¸‹é¢çš„å„ä½å¤§ä½¬å„æ˜¾ç¥é€šï¼Œæˆ‘ä¹Ÿæ‰‹ç—’ï¼Œæ‹¿èµ·æˆ‘çš„æœºæ¢°é”®ç›˜ä¸€é¡¿ä¹±æ•²ï¼Œå‘ç°åªéœ€è¦30è¡Œä»£ç å°±å¯ä»¥å®ç°ï¼Œä¼¼ä¸ä¼¼å¾ˆè…»å®³ğŸ‘»ğŸ‘»ï¼Œå¿«æ¥è·Ÿæˆ‘å¾€ä¸‹ç¿»ğŸ˜›</p>\n</blockquote>\n<p><strong>2019-03-14æ™šè¡¥å……ï¼šåƒäº†æ™šé¥­çœ‹åˆ°å¤§ä½¬ @serialcoder çš„å›å¤ï¼Œç›´æ¥çŸ³åŒ–äº†ï¼Œåˆä»”ç»†è¯»äº†ä¸€éé¢˜ç›®ï¼Œå‘ç°ç¡®å®å®¡é”™é¢˜ç›®äº†ï¼Œå¤ªå¤§æ„äº†ğŸ˜¢æˆ‘ä¹‹å‰çš„å®ç°æ˜¯å¤šä¸ªè¯·æ±‚åŒæ—¶è¿›è¡Œï¼Œä½†ä¸æ˜¯å¹¶å‘ï¼Œè€Œæ˜¯å¤šä¸ªåŒæ—¶è¿›è¡Œçš„ä¸²è¡Œã€‚äºæ˜¯ä¹æˆ‘å¼€å§‹äº†åˆä¸€é¡¿ä¹±æ•²ï¼Œå·®ä¸å¤šåŠå°æ—¶æå®šã€‚è¿™ä¼šåº”è¯¥æ²¡é”™äº†ï¼Œè€Œä¸”åªç”¨äº†23è¡Œï¼Œèµ¶ç´§æŠŠæ ‡é¢˜ä¹Ÿç»™æ”¹äº†ğŸ˜</strong></p>\n<h2>åŸé¢˜</h2>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/18ab74d2feac91d3ce4930980e5045c2/67ac9/20190314094258595_1357644231.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 800px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 29.921875000000004%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABWElEQVQY0z2R61KjQBCF8/4vYemqS0yMURFDEkiQRAiX4TIMgbi7r/Jtg1X+OHVmpqq/Pt0zqU4JZRyzX7kctp74mqPnk4Yh4WbLYeNRRDGNUnR1ParXmotuKJOUtqwwRYlRBeeqYhLtghH0eG/xeGdhXd0wvbnl6fcUZ7Fka7/hLm0Cd4DvOAUHNq+OnH0+XI94F4r7vM6e+PRDJr7zzloKHq5umV+Lflks72cjLN5/SNLPUX9Nx5c+88/09JURNfxpWlHHRe4mr+jLRoDPL7gzSSIdjs5Kuq/w7DXqGGHSDJMo6ihFnzKaVFGdcikuKeUtCY6YTNGqijrJabKCiTtb8GbN2T7LWDLe3rYJ3TU6TbnIbjpVcs4HL+iLiq+6lSR6hOs0F5gaZXJpNACd6Zz3hwWbxQs7gYaOSxTs0VlGV8ii1bfaXI1+kU8Y4DqRxNmQVv1AB/0Hg96MvjhPvasAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;\"\n        alt=\"20190314094258595 1357644231\"\n        title=\"\"\n        src=\"/static/18ab74d2feac91d3ce4930980e5045c2/b21dd/20190314094258595_1357644231.png\"\n        srcset=\"/static/18ab74d2feac91d3ce4930980e5045c2/2d451/20190314094258595_1357644231.png 200w,\n/static/18ab74d2feac91d3ce4930980e5045c2/06807/20190314094258595_1357644231.png 400w,\n/static/18ab74d2feac91d3ce4930980e5045c2/b21dd/20190314094258595_1357644231.png 800w,\n/static/18ab74d2feac91d3ce4930980e5045c2/c9309/20190314094258595_1357644231.png 1200w,\n/static/18ab74d2feac91d3ce4930980e5045c2/67ac9/20190314094258595_1357644231.png 1280w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<blockquote>\n<p>é¢˜ç›®æ¥æºï¼š<a href=\"https://juejin.im/post/5c88aaa05188257e1f2925a8?utm_source=gold_browser_extension\">è®°ä¸€é“æ§åˆ¶å¹¶å‘æ•°çš„å‰ç«¯é¢è¯•é¢˜ã€æ‰‹åŠ¨ç»´æŠ¤ HTTP è¯·æ±‚æ’é˜Ÿã€‘</a></p>\n</blockquote>\n<h2>æ€è·¯</h2>\n<h3>è¯»é¢˜</h3>\n<p><del>å¿«é€Ÿè¿‡ä¸€éé¢˜ç›®ï¼Œå¯ä»¥è·å¾—è¿™å‡ ä¸ªä¸»è¦ä¿¡æ¯ï¼š</del>ï¼ˆç½ªé­ç¥¸é¦–ï¼Œè¯»é¢˜è¦ä»”ä»”ç»†ç»†çš„è¯»ï¼Œä¸èƒ½è´ªå¿«ğŸ˜¢ï¼‰</p>\n<ol>\n<li>æ‰¹é‡è¯·æ±‚</li>\n<li>å¯æ§åˆ¶å¹¶å‘åº¦</li>\n<li>å…¨éƒ¨è¯·æ±‚ç»“æŸï¼Œæ‰§è¡Œ <code class=\"language-text\">callback</code></li>\n</ol>\n<h3>è§£é¢˜</h3>\n<ol>\n<li>æ‰¹é‡è¯·æ±‚</li>\n</ol>\n<p>è¦å®ç°æ‰¹é‡è¯·æ±‚ï¼Œè€Œä¸”å¹¶ä¸éœ€è¦æŒ‰é¡ºåºå‘èµ·è¯·æ±‚ï¼ˆå¦‚æœéœ€è¦æŒ‰é¡ºåºå¯ä»¥å­˜å…¥é˜Ÿåˆ—ä¸­ï¼ŒæŒ‰ä¼˜å…ˆçº§åˆ™å¯ä»¥å­˜å…¥ä¼˜å…ˆé˜Ÿåˆ—ä¸­ï¼‰ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å­˜å…¥æ•°ç»„ä¸­å³å¯ï¼Œç„¶åè¿›è¡Œéå†ï¼Œå–å‡ºæ•°å­—ä¸­çš„æ¯ä¸€é¡¹ä¸¢å»<code class=\"language-text\">fetch</code>ä¸­è¿›è¡Œè°ƒç”¨ã€‚</p>\n<ol start=\"2\">\n<li>å¯æ§åˆ¶å¹¶å‘åº¦</li>\n</ol>\n<p><del>æ§åˆ¶å¹¶å‘æ•°ï¼Œä¸€ä¸ªç®€å•çš„åŠæ³•å°±æ˜¯å¯¹æ•°ç»„è¿›è¡Œåˆ‡ç‰‡ï¼Œåˆ†æˆä¸€æ®µä¸€æ®µï¼Œå®Œæˆä¸€æ®µåå†è°ƒç”¨å¦ä¸€æ®µã€‚è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨é€’å½’æˆ–è€…å¾ªç¯æ¥å®ç°ï¼Œæˆ‘è§‰å¾—é€’å½’æ¯”è¾ƒç›´è§‚ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨é€’å½’æ¥å®ç°ã€‚</del>\næœ¬é¢˜çš„éš¾ç‚¹å°±åœ¨è¿™é‡Œï¼Œä¹‹å‰åšé”™äº†å°±æ˜¯è¿™ä¸€æ­¥ã€‚åœ¨æ§åˆ¶å¹¶å‘æ•°çš„åŒæ—¶ï¼Œæ¯ç»“æŸä¸€ä¸ªè¯·æ±‚å¹¶å‘èµ·ä¸€ä¸ªæ–°çš„è¯·æ±‚ã€‚ä¾æ—§ä½¿ç”¨é€’å½’çš„æ–¹å¼ï¼Œä½†è¿™æ¬¡æ·»åŠ ä¸€ä¸ªè¯·æ±‚é˜Ÿåˆ—ï¼Œç„¶åæˆ‘ä»¬åªè¦ç»´æŠ¤è¿™ä¸ªé˜Ÿåˆ—ï¼Œæ¯æ¬¡å‘èµ·ä¸€ä¸ªè¯·æ±‚å°±æ·»åŠ è¿›å»ï¼Œç»“æŸä¸€ä¸ªå°±ä¸¢å‡ºæ¥ï¼Œç»§è€Œå®ç°äº†æ§åˆ¶å¹¶å‘ã€‚</p>\n<ol start=\"3\">\n<li>å…¨éƒ¨è¯·æ±‚ç»“æŸï¼Œæ‰§è¡Œ <code class=\"language-text\">callback</code></li>\n</ol>\n<p>å› ä¸ºæ˜¯å¼‚æ­¥è¯·æ±‚ï¼Œæˆ‘ä»¬æ— æ³•å¯„å¸Œæœ›äºå®‰è£…æ­£å¸¸çš„é¡ºåºåœ¨å‡½æ•°è°ƒç”¨åæ‰§è¡Œï¼Œä½†æ˜¯æ¯æ¬¡<code class=\"language-text\">fetch</code>æœ‰è¿”å›ç»“æœä¼šè°ƒç”¨<code class=\"language-text\">then</code>æˆ–è€…<code class=\"language-text\">catch</code>ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªæ—¶å€™åˆ¤æ–­è¯·æ±‚æ•°ç»„æ˜¯å¦ä¸ºç©ºå°±å¯ä»¥çŸ¥é“æ˜¯å¦å…¨éƒ¨è¢«è°ƒç”¨å®Œ</p>\n<h3>å†™é¢˜</h3>\n<h3>ä¹‹å‰âŒçš„ä»£ç </h3>\n<p>è¿™ä¸€æ­¥å°±æ²¡ä»€ä¹ˆå¯ä»¥è¯´çš„äº†ï¼Œæ’¸èµ·è¢–å­å°±æ˜¯æ•²~</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">handleFetchQueue</span><span class=\"token punctuation\">(</span>urls<span class=\"token punctuation\">,</span> max<span class=\"token punctuation\">,</span> callback<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> requestArr <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  urls<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">,</span> idx<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> i <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>idx <span class=\"token operator\">/</span> max<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>requestArr<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      requestArr<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      requestArr<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>item<span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleSubRequests</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>subReqs<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> results <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    subReqs<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>req <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>res <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>results<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> max<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>requestArr<span class=\"token punctuation\">.</span>length <span class=\"token operator\">&lt;</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token string\">'function'</span> <span class=\"token operator\">===</span> <span class=\"token keyword\">typeof</span> callback <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span>results<span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">handleSubRequests</span><span class=\"token punctuation\">(</span>requestArr<span class=\"token punctuation\">.</span><span class=\"token function\">shift</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> requestArr<span class=\"token punctuation\">,</span> max<span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span>e <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        results<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">handleSubRequests</span><span class=\"token punctuation\">(</span>requestArr<span class=\"token punctuation\">.</span><span class=\"token function\">shift</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>è¿™é‡Œéœ€è¦ç¨å¾®æä¸€ä¸‹çš„ä¸¤ä¸ªå°æŠ€å·§ï¼š</p>\n<ul>\n<li>é€šè¿‡<code class=\"language-text\">Math.floor(idx / max)</code>æˆ‘ä»¬å¯ä»¥è½»æ¾çš„å°†æ¯ä¸€é¡¹æ¨å…¥æ­£ç¡®çš„å­æ•°ç»„ä¸­</li>\n<li>å–„ç”¨æ•°ç»„çš„è¿”å›å€¼ï¼š<code class=\"language-text\">results.push(res)</code>è¿”å›æ•°ç»„é•¿åº¦ï¼Œç›´æ¥ç”¨å°±å¥½å•¦</li>\n</ul>\n<p>é™„ä¸Šå®Œæ•´æµ‹è¯•ä»£ç ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">handleFetchQueue</span><span class=\"token punctuation\">(</span>urls<span class=\"token punctuation\">,</span> max<span class=\"token punctuation\">,</span> callback<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> requestArr <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  urls<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">,</span> idx<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> i <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>idx <span class=\"token operator\">/</span> max<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>requestArr<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      requestArr<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      requestArr<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>item<span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleSubRequests</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>subReqs<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> results <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    subReqs<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>req <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>res <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>results<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> max<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>requestArr<span class=\"token punctuation\">.</span>length <span class=\"token operator\">&lt;</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token string\">'function'</span> <span class=\"token operator\">===</span> <span class=\"token keyword\">typeof</span> callback <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span>results<span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">handleSubRequests</span><span class=\"token punctuation\">(</span>requestArr<span class=\"token punctuation\">.</span><span class=\"token function\">shift</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> requestArr<span class=\"token punctuation\">,</span> max<span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span>e <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        results<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">handleSubRequests</span><span class=\"token punctuation\">(</span>requestArr<span class=\"token punctuation\">.</span><span class=\"token function\">shift</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n\n<span class=\"token keyword\">const</span> urls <span class=\"token operator\">=</span> Array<span class=\"token punctuation\">.</span><span class=\"token keyword\">from</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>length<span class=\"token punctuation\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">,</span> k<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> k<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">fetch</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span>idx<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span>resolve <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`start request </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>idx<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// æ¨¡æ‹Ÿè¯·æ±‚æ—¶é—´</span>\n    <span class=\"token keyword\">const</span> timeout <span class=\"token operator\">=</span> <span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">1e4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`end request </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>idx<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>idx<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> timeout<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> max <span class=\"token operator\">=</span> <span class=\"token number\">4</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">callback</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'run callback'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">handleFetchQueue</span><span class=\"token punctuation\">(</span>urls<span class=\"token punctuation\">,</span> max<span class=\"token punctuation\">,</span> callback<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>å› ä¸ºæˆ‘åœ¨ Node ä¸­è¿è¡Œï¼Œ(lan)æ‡’(ai)å¾—(fa)ä¸¢(zuo)æµè§ˆå™¨ä¸­å»è·‘äº†ï¼Œæ‰€ä»¥éšæ‰‹æ¨¡æ‹Ÿäº†ä¸€ä¸ª<code class=\"language-text\">fetch</code>å‡½æ•°ã€‚</p>\n<h3>âœ…çš„ä»£ç </h3>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">handleFetchQueue</span><span class=\"token punctuation\">(</span>urls<span class=\"token punctuation\">,</span> max<span class=\"token punctuation\">,</span> callback<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> urlCount <span class=\"token operator\">=</span> urls<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> requestsQueue <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> results <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleRequest</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> req <span class=\"token operator\">=</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>res <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> len <span class=\"token operator\">=</span> results<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>len <span class=\"token operator\">&lt;</span> urlCount <span class=\"token operator\">&amp;&amp;</span> i <span class=\"token operator\">+</span> <span class=\"token number\">1</span> <span class=\"token operator\">&lt;</span> urlCount<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        requestsQueue<span class=\"token punctuation\">.</span><span class=\"token function\">shift</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">handleRequest</span><span class=\"token punctuation\">(</span>urls<span class=\"token punctuation\">[</span><span class=\"token operator\">++</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>len <span class=\"token operator\">===</span> urlCount<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">'function'</span> <span class=\"token operator\">===</span> <span class=\"token keyword\">typeof</span> callback <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span>results<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span>e <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      results<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>requestsQueue<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> max<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">handleRequest</span><span class=\"token punctuation\">(</span>urls<span class=\"token punctuation\">[</span><span class=\"token operator\">++</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">handleRequest</span><span class=\"token punctuation\">(</span>urls<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>âŒä»£ç å’Œâœ…ä»£ç æµ‹è¯•æ¯”å¯¹</h3>\n<p>å…ˆæ¥çœ‹é”™è¯¯çš„ï¼Œå¯ä»¥å‘ç°æ˜¯ä¸²è¡Œæ‰§è¡Œçš„ï¼š</p>\n<p><img src=\"/20190314192833588_726792028-00992cac756aff854d1f1da9f212988d.gif\" alt=\"âŒ\"></p>\n<p>å†çœ‹æ­£ç¡®çš„ä»£ç ï¼Œè¿™æ‰æ˜¯å¹¶å‘ï¼š</p>\n<p><img src=\"/20190314192900520_1724872067-c160fb269008b0df4c6b11fba9edbed4.gif\" alt=\"âœ…\"></p>\n<p>è´´ä¸Šå®Œæ•´ä»£ç ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">handleFetchQueue</span><span class=\"token punctuation\">(</span>urls<span class=\"token punctuation\">,</span> max<span class=\"token punctuation\">,</span> callback<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> urlCount <span class=\"token operator\">=</span> urls<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> requestsQueue <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> results <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleRequest</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> req <span class=\"token operator\">=</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>res <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'å½“å‰å¹¶å‘ï¼š '</span><span class=\"token operator\">+</span>requestsQueue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">const</span> len <span class=\"token operator\">=</span> results<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>len <span class=\"token operator\">&lt;</span> urlCount <span class=\"token operator\">&amp;&amp;</span> i <span class=\"token operator\">+</span> <span class=\"token number\">1</span> <span class=\"token operator\">&lt;</span> urlCount<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        requestsQueue<span class=\"token punctuation\">.</span><span class=\"token function\">shift</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">handleRequest</span><span class=\"token punctuation\">(</span>urls<span class=\"token punctuation\">[</span><span class=\"token operator\">++</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>len <span class=\"token operator\">===</span> urlCount<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">'function'</span> <span class=\"token operator\">===</span> <span class=\"token keyword\">typeof</span> callback <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span>results<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span>e <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      results<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>requestsQueue<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> max<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">handleRequest</span><span class=\"token punctuation\">(</span>urls<span class=\"token punctuation\">[</span><span class=\"token operator\">++</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">handleRequest</span><span class=\"token punctuation\">(</span>urls<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n\n<span class=\"token keyword\">const</span> urls <span class=\"token operator\">=</span> Array<span class=\"token punctuation\">.</span><span class=\"token keyword\">from</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>length<span class=\"token punctuation\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">,</span> k<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> k<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">fetch</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span>idx<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span>resolve <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`start request </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>idx<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> timeout <span class=\"token operator\">=</span> <span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">1e4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`end request </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>idx<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>idx<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> timeout<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> max <span class=\"token operator\">=</span> <span class=\"token number\">4</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">callback</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'run callback'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n\n<span class=\"token function\">handleFetchQueue</span><span class=\"token punctuation\">(</span>urls<span class=\"token punctuation\">,</span> max<span class=\"token punctuation\">,</span> callback<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>æ€»ç»“</h2>\n<p>é€šè¿‡<strong>è¯»é¢˜</strong>ã€<strong>è§£é¢˜</strong>å’Œ<strong>å†™é¢˜</strong>ä¸‰ä¸ªæ­¥éª¤ï¼ˆè‡ªåˆ›çš„ğŸ˜›ï¼‰ï¼Œå¯ä»¥è®©æˆ‘ä»¬çš„æ€è·¯éå¸¸æ¸…æ™°ï¼Œéå¸¸ easy çš„è§£å†³é¢è¯•é¢˜ã€‚</p>\n<p>é¢˜ç›®æ•²äº†20åˆ†é’Ÿä»£ç è§£å†³ï¼Œä½†æ˜¯æ–‡ç« å†™äº†ä¸€å°æ—¶ï¼Œå¤ªä¸å®¹æ˜“äº†ï¼Œè§‰å¾—ä¸é”™è¯·ç»™æˆ‘é¼“ä¸ªæŒ~~</p>\n<p>åœ¨åšä¹‹å‰æ›´åŠ é‡è¦çš„æ˜¯ä¸èƒ½æ‰ä»¥è½»å¿ƒï¼Œå…å¾—å°´å°¬~~</p>","fields":{"slug":"/30è¡Œä»£ç å®ç°ä¸€ä¸ªå¸¦å¹¶å‘æ•°é™åˆ¶çš„fetchè¯·æ±‚å‡½æ•°/","prefix":"2019-03-14"},"frontmatter":{"title":"23è¡Œä»£ç å®ç°ä¸€ä¸ªå¸¦å¹¶å‘æ•°é™åˆ¶çš„fetchè¯·æ±‚å‡½æ•°","author":"Jason Zeng","category":"æ€è€ƒ","cover":{"childImageSharp":{"resize":{"src":"/static/4b36f72ceecac8def049860c5abf76d5/ada8c/photo-1494256997604-768d1f608cac.jpeg"}}}}},"authornote":{"id":"eeaf3f36-861e-5339-a4a4-e63a63ccd23c","html":"<p><a href=\"https://github.com/zenghongtu\">Jason Zeng</a></p>"},"site":{"siteMetadata":{"facebook":{"appId":"2349655921921608"}}}},"pageContext":{"slug":"/30è¡Œä»£ç å®ç°ä¸€ä¸ªå¸¦å¹¶å‘æ•°é™åˆ¶çš„fetchè¯·æ±‚å‡½æ•°/","prev":{"id":"f36d4234-7b43-5dd1-967f-6e938b3b64fc","fields":{"slug":"/å¯èƒ½æ˜¯æœ€å…¨ä¸€ç¯‡çš„å‰ç«¯å¼‚å¸¸ç›‘æ§æ€»ç»“/","prefix":"2019-03-05","source":"posts"},"frontmatter":{"title":"å¯èƒ½æ˜¯æœ€å…¨ä¸€ç¯‡çš„å‰ç«¯å¼‚å¸¸ç›‘æ§æ€»ç»“","category":"å‰ç«¯ç›‘æ§"}},"next":{"id":"8fed252b-5867-51a7-911f-2f95c4ca6830","fields":{"slug":"/CSS æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼ˆæŒç»­æ›´æ–°ï¼‰/","prefix":"2019-03-25","source":"posts"},"frontmatter":{"title":"CSS æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼ˆæŒç»­æ›´æ–°ï¼‰","category":"CSS"}},"source":"posts"}}