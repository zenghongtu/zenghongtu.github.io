{"data":{"post":{"id":"2644b8a2-79d5-54ab-8f16-67e807b09be7","html":"<p>title: Python网络爬虫之网易云阅读\nauthor: 大图\ntags:</p>\n<ul>\n<li>\n<p>python</p>\n</li>\n<li>\n<p>爬虫\ncategories:</p>\n</li>\n<li>\n<p>爬虫\ndate: 2017-06-12 15:09:00</p>\n<hr>\n<p>Python网络爬虫之网易云阅读\n获取网易云阅读上面的书籍，保存为html或pdf文档</p>\n</li>\n<li>\n<p>书籍列表\n以 <a href=\"http://yuedu.163.com/book/category/category/800/1_0_1\">http://yuedu.163.com/book/category/category/800/1<em>0</em>1</a> 为例，利用bs4解析网页，获取书籍基本信息</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">from bs4 import BeautifulSoup\nimport requests</code></pre></div>\n</li>\n</ul>\n<p>def book<em>list(url):\nhtml=requests.get(url,headers=headers).text\ntable=BeautifulSoup(html,‘lxml’).find(‘div’,{‘class’:‘yd-book-content’}).find</em>all(‘div’,{‘class’:‘yd-book-item’})\nresult=[]\nfor item in table:\nbook={}\nbook[‘title’]=item.find(‘h2’).get<em>text()\nbook[‘bookid’]=item.find(‘a’).get(‘href’).split(’/‘)[-1]\nbook[‘imgurl’]=item.find(‘img’).get(‘src’)\nbook[‘author’]=item.find(‘div’,{‘class’:‘author-container’}).get</em>text().replace(‘\\r’,”).replace(’\n’,”).replace(‘作者：’,”)\nbook[‘des’]=item.find(‘div’,{‘class’:‘summery’}).find(‘p’).get_text()\nresult.append(book)\nreturn result</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">url=&#39;http://yuedu.163.com/book/category/category/800/1_0_1&#39;\nbooks=book_list(url)\n结果：</code></pre></div>\n<p>[{‘bookid’: ‘a712c2e2b6614071a955eb0a691660dd_4’, ‘imgurl’: ’<a href=\"http://easyread.ph.126.net/niFTagmTvVReiBayQX8D8g==/7806550149396531191.jpg&#x27;\">http://easyread.ph.126.net/niFTagmTvVReiBayQX8D8g==/7806550149396531191.jpg’</a>, ‘title’: ‘拖延心理学’, ‘author’: ’[美] 简·博克(Jane B. Burka) / [美] 莱诺拉’, ‘des’: …</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">2. 获取图书\n通过分析网页请求，加载图书的过程是：\n\n先从 http://yuedu.163.com/getBook.do?id=cdc23633-3b65-4d5a-960c-eec52c52bf1b_4&amp;tradeId= 获取图书的一些基本信息，以及各个章节的信息，链接中的id为图书的id;\n\n再从 http://yuedu.163.com/getArticleContent.do?sourceUuid={sourceUuid}&amp;articleUuid={articleUuid}&amp;bigContentId={bigContentId}\n获取各章节的数据，返回的数据为base64编码，解码后为章节的html数据;sourceUuid为图书id,articleUuid和bigContentId第一步中可以得到;</code></pre></div>\n<p>import json\nimport base64</p>\n<p>def get_book(bookid):\nhtml=requests.get(’<a href=\"http://yuedu.163.com/getBook.do?id=&#x27;+bookid,headers=headers\">http://yuedu.163.com/getBook.do?id=‘+bookid,headers=headers</a>).text\ndata=json.loads(html)\nbook={}\nbook[‘title’]=data[‘title’]\nbook[‘bookid’]=data[‘id’]\nbook[‘author’]=data[‘author’]\nbook[‘coverImg’]=data[‘coverImg’]\nbook[‘shareDescription’]=data[‘shareDescription’]\npages=[]\nfor item in data[‘portions’]:\npage={}\npage[‘title’]=item[‘title’]\npage[‘articleUuid’]=item[‘id’]\npage[‘bigContentId’]=item[‘bigContentId’]\npages.append(page)\nbook[‘pages’]=pages\nreturn book</p>\n<p>def article_content(bookid,articleUuid,bigContentId=”):\nhtml=requests.get(’<a href=\"http://yuedu.163.com/getArticleContent.do?sourceUuid=%7BsourceUuid%7D&#x26;articleUuid=%7BarticleUuid%7D&#x26;bigContentId=%7BbigContentId%7D&#x27;.format(sourceUuid=bookid,articleUuid=articleUuid,bigContentId=bigContentId),headers=headers\">http://yuedu.163.com/getArticleContent.do?sourceUuid={sourceUuid}&#x26;articleUuid={articleUuid}&#x26;bigContentId={bigContentId}‘.format(sourceUuid=bookid,articleUuid=articleUuid,bigContentId=bigContentId),headers=headers</a>).text\ndata=json.loads(html)\narticle=base64.b64decode(data[‘content’])\nreturn article.decode()</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">3. 保存为html文档或pdf文档\n这里用的是pdfkit，具体安装和使用可以查看项目地址: https://github.com/JazzCore/python-pdfkit</code></pre></div>\n<p>import time\nimport pdfkit</p>\n<p>def download(book):\nhtml='''<!DOCTYPE html>\n<html>\n<head>\n<meta charset=\"utf-8\">\n<title>\n</head>\n<body>\n{body}\n</body>\n</html>'''\nbook<em>text=”\nfor page in book[‘pages’]:\nbook</em>text+=article<em>content(book[‘bookid’],page[‘articleUuid’],page[‘bigContentId’])+’<br><br><br>\n’\ntime.sleep(0.2)\nhtml=html.format(body=book</em>text)\nfilename=book[‘title’]\nwith open(filename+‘.html’,‘w’) as f:\nf.write(html)\nhtml2pdf(html,filename++‘.pdf’)</p>\n<p>def html2pdf(html,filename):\noptions={\n‘page-size’: ‘Letter’,\n‘margin-top’: ‘0.75in’,\n‘margin-right’: ‘0.75in’,\n‘margin-bottom’: ‘0.75in’,\n‘margin-left’: ‘0.75in’,\n‘encoding’: “UTF-8”,\n‘no-outline’: None\n}\npdfkit.from_string(html,filename,options=options)</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"></code></pre></div>","fields":{"slug":"/Python网络爬虫之网易云阅读/","prefix":null},"frontmatter":{"title":"","author":null,"category":null,"cover":null}},"authornote":{"id":"f3ffdeef-a16f-507d-9f2f-98fa5e045d0b","html":"<p><strong>Mr. Gatsby</strong> Proin ornare ligula eu tellus tempus elementum. Aenean <a href=\"/\">bibendum</a> iaculis mi, nec blandit lacus interdum vitae. Vestibulum non nibh risus, a scelerisque purus. Blandit lacus interdum vitae. Vestibulum non nibh risus, a scelerisque purus.</p>"},"site":{"siteMetadata":{"facebook":{"appId":""}}}},"pageContext":{"slug":"/Python网络爬虫之网易云阅读/","next":{"id":"867c0a75-ead9-5770-9baf-fa791b246d7b","fields":{"slug":"/python网络爬虫之动态网络/","prefix":null,"source":"posts"},"frontmatter":{"title":"","category":null}},"source":"posts"}}