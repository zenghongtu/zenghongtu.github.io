{"data":{"post":{"id":"7e980257-d35d-5a70-9ef3-984c8d84cca9","html":"<p>前言：之前用 Hexo 搭建的博客，稀稀散散的写一些时间，后来就懒了没有坚持下来，中断了足足一年没写了。这几天心血来潮，决定重新搭建一个，一是监督自己完成制定的计划（每周一篇，每月五篇文章），二是与各位老铁分享学习心得，三则是建立自己的知识体系，毕竟好记性不如烂笔头嘛。昨天花了一天多的时间完成了现在这个博客的模样，为什么搭个博客要花这么久，因为这里面涉及到了一些我之前没有接触过的技术，比如GraphQL、Travis CI，我都有认真的去学习了一下，还有就是把之前在 Hexo 上的几篇修改了一下添加到现在这个博客中了。接下来进入主题。</p>\n<h2>主题安装</h2>\n<p>为什么是主题安装呢？\n因为这个主题已经帮我们打包搞定了我们需要的包括了分类、分页等等功能，直接安装它即可</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">npx gatsby new my-blog-starter https://github.com/gatsbyjs/gatsby-starter-blog\n<span class=\"token function\">cd</span> my-blog-starter/\ngatsby develop</code></pre></div>\n<p>然后我们可以看到如下内容：</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">You can now view gatsby-starter-hero-blog <span class=\"token keyword\">in</span> the browser.\n\n  http://localhost:8000/\n\nView GraphiQL, an in-browser IDE, to explore your site's data and schema\n\n  http://localhost:8000/___graphql\n\nNote that the development build is not optimized.\nTo create a production build, use gatsby build</code></pre></div>\n<p>现在就可以访问<code class=\"language-text\">http://localhost:8000/</code>来访问博客</p>\n<p>更多内容可以查看这里<a href=\"https://github.com/greglobinski/gatsby-starter-hero-blog\">gatsby-starter-hero-blog</a></p>\n<h2>修改配置</h2>\n<p>可以正常启动后，我们就可以开始修改配置了。</p>\n<p>在<code class=\"language-text\">content</code>文件夹中进行配置，具体如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">├── meta <span class=\"token comment\"># 存放 meta 相关文件</span>\n│   └── config.js  <span class=\"token comment\"># 网站信息、作者信息等设置</span>\n├── pages <span class=\"token comment\"># 可自定义的添加页面，支持 HTML 标签</span>\n│   ├── 1--about\n│   │   └── index.md\n│   ├── 2--starters\n│   │   ├── gatsby-starter-personal-blog.png\n│   │   ├── gatsby-starter-simple-landing.png\n│   │   └── index.md\n│   ├── 3--front-end-dev\n│   │   └── index.md\n│   ├── 4--privacy\n│   │   └── index.md\n│   ├── 5--terms\n│   │   └── index.md\n│   └── success\n│       └── index.md\n├── parts  <span class=\"token comment\"># 区块，相当于组件</span>\n│   ├── author.md\n│   └── footnote.md\n└── posts <span class=\"token comment\"># 存放文章</span>\n    ├── 2017-10-01--two-things-are-infinite  <span class=\"token comment\"># 文件夹名必须是 日期--文章名 </span>\n    │   ├── index.md   <span class=\"token comment\"># 文章</span>\n    │   └── photo-1490474418585-ba9bad8fd0ea.jpg <span class=\"token comment\"># cover</span>\n    ├── 2017-10-03--be-who-you-are\n    │   ├── index.md\n    │   └── photo-1489824904134-891ab64532f1.jpg\n    ├── 2017-10-05--you-only-live-once\n    │   ├── index.md\n    │   └── photo-1456518563096-0ff5ee08204e.jpg\n    ├── 2017-10-07--people-will-forget\n    │   ├── index.md\n    │   └── photo-1489900464632-5f5907edda24.jpg\n    ├── 2017-10-09--i-am-so-clever\n    │   ├── index.md\n    │   └── photo-1507124484497-b7f446e65519.jpg\n    ├── 2017-10-11--imperfection-is-beauty\n    │   ├── index.md\n    │   └── photo-1469461084727-4bfb496cf55a.jpg\n    ├── 2017-10-13--there-are-only-two\n    │   ├── index.md\n    │   └── photo-1451324119451-db0ac857463c.jpg\n    ├── 2017-10-15--good-friends\n    │   ├── index.md\n    │   └── photo-1500531279542-fc8490c8ea4d.jpg\n    ├── 2017-10-17--i-have-not-failed\n    │   ├── index.md\n    │   └── photo-1463852247062-1bbca38f7805.jpg\n    ├── 2017-10-19--i-may-not-have-gone\n    │   ├── index.md\n    │   └── photo-1507915600431-5292809c5ab7.jpg\n    ├── 2017-10-21--like-nonsense\n    │   ├── 33893097-e5a70c34-df5a-11e7-8f5e-40e057626770.png\n    │   ├── index.md\n    │   └── photo-1465070845512-2b2dbdc6df66.jpg\n    └── draft-post\n        ├── index.md\n        └── photo-1490474418585-ba9bad8fd0ea.jpg</code></pre></div>\n<p>每篇文章 markdown 必须在前面加上如下文章信息，不然会运行报错：</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">---\ntitle: Good friends, good books, and a sleepy conscience\ncover: photo-1500531279542-fc8490c8ea4d.jpg\nauthor: greg lobinski\n---</code></pre></div>\n<h2>发布至 GitHub 仓库</h2>\n<p>首先安装 gh-pages</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">yarn add -D gh-pages</code></pre></div>\n<p>然后在<code class=\"language-text\">package.json</code>中添加如下命令：</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">...\n<span class=\"token property\">\"deploy\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"npm run build &amp;&amp; gh-pages -r git@github.com:zenghongtu/zenghongtu.github.io.git -b master -d public\"</span><span class=\"token punctuation\">,</span>\n...</code></pre></div>\n<p>运行该命令会打包并发布至目标仓库，其中<code class=\"language-text\">-r</code>后面添加的是上传的目标仓库，<code class=\"language-text\">-b</code>后面是目标分支，<code class=\"language-text\">-d</code>后面是需要发布的文件夹。</p>\n<p>这个时候，我们可以打开相对应的地址，我这里是<code class=\"language-text\">zenghongtu.github.io</code>，查看部署后的博客。</p>\n<h2>添加 Travis CI 自动构建</h2>\n<p>接下来才是我们的重头戏，通过 Travis CI 实现自动构建。</p>\n<p>首先到<a href=\"https://travis-ci.org\">travis-ci</a>注册账号，并绑定我们的 GitHub 账号，找到我们项目的仓库，我这里是<code class=\"language-text\">my-blog</code>，打开后面的小开关。如下：\n\n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 663px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 7.8431372549019605%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAP0lEQVQI12P48uXLfxD49+8fGBMLYGo///r1f/P9B/+//v79/++fP/8Zvn79SpGB34EGHXz67P83IP3v79//AAK0nb5gBKhAAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;\"\n        alt=\"20190218020724313 1015713666\"\n        title=\"\"\n        src=\"/static/e7cb4175b0599f5b0e8d1963d7143b4f/489de/20190218020724313_1015713666.png\"\n        srcset=\"/static/e7cb4175b0599f5b0e8d1963d7143b4f/ea0d9/20190218020724313_1015713666.png 200w,\n/static/e7cb4175b0599f5b0e8d1963d7143b4f/91024/20190218020724313_1015713666.png 400w,\n/static/e7cb4175b0599f5b0e8d1963d7143b4f/489de/20190218020724313_1015713666.png 663w\"\n        sizes=\"(max-width: 663px) 100vw, 663px\"\n      />\n    </span>\n  </span>\n  </p>\n<p>然后在<em>设置</em>里面把需要的环境变量填入：</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/eaa5fcb723fad273eb91f1ad203cc036/8c4c8/20190218020809691_752074459.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 800px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 48.88653234358431%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABLUlEQVQoz3WSi66CMBBE+f9fREAQgvJGEJXX2tPrEkKuJhNLtz2d2dYZxlGyx0PyYZC076V/v2WZZ5kPWpZF1nXdxDeixrf+nLcBlFUlFapradpWmqaR+/0urRmrmMvzXLIss2LMHuZfr5dM02RlgdntJjejsiikNy4H4/ZhXKuez6fU5rDT6SSu64rneRKGod2jazm067o/YGFAZVnaApMI8H6MmyAIrM7n8wakhki0AbGPFKqLFMocQN/3rYACvF6v/wPpCUX+i2/sfWRi0StgxAUYRZFdr5E1yeaQDUxy0t6hwukhIHV4uVwsUBPpPmc0zwZXAPdxtX+/eoh+Rqa5nMZNHd2pQ4DEPd7y3qEF4rD6vkNi0ZOjeDZsiOPYKkkSSdPUXiI11uhz+wD/iPmWeNfqswAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;\"\n        alt=\"20190218020809691 752074459\"\n        title=\"\"\n        src=\"/static/eaa5fcb723fad273eb91f1ad203cc036/b21dd/20190218020809691_752074459.png\"\n        srcset=\"/static/eaa5fcb723fad273eb91f1ad203cc036/2d451/20190218020809691_752074459.png 200w,\n/static/eaa5fcb723fad273eb91f1ad203cc036/06807/20190218020809691_752074459.png 400w,\n/static/eaa5fcb723fad273eb91f1ad203cc036/b21dd/20190218020809691_752074459.png 800w,\n/static/eaa5fcb723fad273eb91f1ad203cc036/8c4c8/20190218020809691_752074459.png 943w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>其中<code class=\"language-text\">GITHUB_TOKEN</code>为 GitHub 的 access_token，需要到 setting 中生成一个，其他的是可选的 key，如果需要开启相关的功能则需要设置。</p>\n<p>然后在项目新建<code class=\"language-text\">.travis.yml</code>文件，添加配置内容：</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">language: node_js\nnode_js: --lts\ncache: <span class=\"token function\">npm</span>\nsudo: required\nbranches:\n  only:\n    - master\n\nbefore_install:\n  - <span class=\"token function\">npm</span> <span class=\"token function\">install</span> -g gatsby\n\ninstall:\n  - <span class=\"token function\">npm</span> <span class=\"token function\">install</span>\n\nbefore_script:\n  - <span class=\"token function\">git</span> config user.name <span class=\"token string\">\"zenghongtu\"</span>\n  - <span class=\"token function\">git</span> config user.email <span class=\"token string\">\"zenghongtu@gmail.com\"</span>\n  - <span class=\"token function\">sed</span> -i<span class=\"token string\">''</span> <span class=\"token string\">\"s~git@github.com:zenghongtu/zenghongtu.github.io.git~https://<span class=\"token variable\">${GITHUB_TOKEN}</span>@github.com/zenghongtu/zenghongtu.github.io.git~\"</span> package.json\n\nscript:\n  - <span class=\"token function\">npm</span> run deploy</code></pre></div>\n<p>每次 push 到仓库，就会调用 Travis CI 自动构建，这样就大功告成了。</p>","fields":{"slug":"/使用Gatsby.js快速搭建静态博客并通过Travis CI轻松实现自动构建/","prefix":"2019-02-18"},"frontmatter":{"title":"使用Gatsby.js快速搭建静态博客并通过Travis CI轻松实现自动构建","author":"Jason Zeng","category":"Gatsby","cover":{"childImageSharp":{"resize":{"src":"/static/08bc60a5fc3d8dce6398004ad59fc05f/ada8c/photo-1548189856-d9e5926307ed.jpeg"}}}}},"authornote":{"id":"eeaf3f36-861e-5339-a4a4-e63a63ccd23c","html":"<p><a href=\"https://github.com/zenghongtu\">Jason Zeng</a></p>"},"site":{"siteMetadata":{"facebook":{"appId":"2349655921921608"}}}},"pageContext":{"slug":"/使用Gatsby.js快速搭建静态博客并通过Travis CI轻松实现自动构建/","prev":{"id":"86eda8fa-7793-555c-b0da-b3c39d722945","fields":{"slug":"/一道JavaScript面试题的思考/","prefix":"2019-01-31","source":"posts"},"frontmatter":{"title":"一道 JavaScript 面试题的思考","category":"思考"}},"next":{"id":"b6db97cf-dd9a-5c81-b16a-90d8f6ce9079","fields":{"slug":"/捋一捋React的生命周期/","prefix":"2019-02-20","source":"posts"},"frontmatter":{"title":"捋一捋React的生命周期","category":"React"}},"source":"posts"}}