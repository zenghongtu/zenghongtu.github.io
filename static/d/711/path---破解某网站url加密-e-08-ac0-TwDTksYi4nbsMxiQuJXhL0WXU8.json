{"data":{"post":{"id":"d3d3818a-fa79-50ac-bd1e-1b8074190fbd","html":"<p>title: 破解某网站url加密\nauthor: 大图\ntags:</p>\n<ul>\n<li>\n<p>js解密\ncategories:</p>\n</li>\n<li>\n<p>爬虫\ndate: 2017-08-15 14:42:00</p>\n<hr>\n<p>想要爬取网站<a href=\"http://dir.scmor.com/google/\">http://dir.scmor.com/google/</a> 中Google镜像站的链接，一眼看去还以为简单提取一下href就好，仔细看看好像没那么简单。</p>\n</li>\n<li>\n<p>分析</p>\n</li>\n</ul>\n<p>网页源码如下，点击现在访问执行visit函数，传入的字符串为base64编码。</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\">&lt; a href=\"javascript:;\" class=\"ok\" onclick=\"visit('DSE8WyM3DBsjQGsWNj5YXSEsEgovACEETDBXUA==')\"> 现在访问 <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>直接将该字符串base64解码得到结果如下。乱码，说明不是简单的将url经过base64编码。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">!&lt;[#7\f\u001b#@k\u00166&gt;X]!,\u0012\n/!\u0004L0WP</code></pre></div>\n<p>通过查找js文件，找到visit函数</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">visit</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> newTab <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">'about:blank'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>Gword <span class=\"token operator\">!=</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span> url <span class=\"token operator\">=</span> <span class=\"token function\">strdecode</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// var newTab = window.open(url);</span>\n    newTab<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>href <span class=\"token operator\">=</span> url<span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">//newTab.location.reload(true);</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>通过javascript源码可以看出，将字符串经过strdecode函数处理后，即可得到真实的url。\nstrdecode函数代码如下</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">strdecode</span><span class=\"token punctuation\">(</span>string<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    string <span class=\"token operator\">=</span> <span class=\"token function\">base64decode</span><span class=\"token punctuation\">(</span>string<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    key <span class=\"token operator\">=</span> Gword<span class=\"token punctuation\">;</span>\n    len <span class=\"token operator\">=</span> key<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\n    code <span class=\"token operator\">=</span> <span class=\"token string\">''</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> string<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> k <span class=\"token operator\">=</span> i <span class=\"token operator\">%</span> len<span class=\"token punctuation\">;</span>\n        code <span class=\"token operator\">+=</span> String<span class=\"token punctuation\">.</span><span class=\"token function\">fromCharCode</span><span class=\"token punctuation\">(</span>string<span class=\"token punctuation\">.</span><span class=\"token function\">charCodeAt</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span> <span class=\"token operator\">^</span> key<span class=\"token punctuation\">.</span><span class=\"token function\">charCodeAt</span><span class=\"token punctuation\">(</span>k<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">base64decode</span><span class=\"token punctuation\">(</span>code<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>通过查找，Gword的值为link@scmor.com。至此，已经了解了网址加密解密的整个过程，可以开始编写代码啦。</p>\n<ol start=\"2\">\n<li>\n<p>Coding</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> requests\n<span class=\"token keyword\">import</span> base64\n<span class=\"token keyword\">import</span> re\n<span class=\"token keyword\">import</span> time</code></pre></div>\n</li>\n</ol>\n<p>headers = {\n‘User-Agent’: ‘Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:39.0) Gecko/20100101 Firefox/39.0’,\n‘Accept’: ‘text/html,application/xhtml+xml,application/xml;q=0.9,<em>/</em>;q=0.8’,\n‘Accept-Language’: ‘en-US,en;q=0.5’,\n‘Accept-Encoding’: ‘gzip, deflate’,\n‘Connection’: ‘keep-alive’}</p>\n<p>def get<em>encoded</em>urls():\nhtml=requests.get(’<a href=\"http://dir.scmor.com/google/&#x27;,headers=headers\">http://dir.scmor.com/google/‘,headers=headers</a>).text.replace(‘\\r’,”).replace(’\n’,”).replace(’ ’,”)\nencoded<em>urls=re.findall(‘autourl[\\d+]=”(.*?)”;‘,html)\nreturn encoded</em>urls</p>\n<p>def from<em>char</em>code(a, *b):\ntry:\nreturn unichr(a%65536) + ”.join([unichr(i%65536) for i in b])\nexcept:\nreturn chr(a%65536) + ”.join([chr(i%65536) for i in b])</p>\n<p>def decode(string):\nstring=base64.b64decode(string).decode(‘utf-8’)\nkey=‘link@scmor.com’\nlength=len(key)\ncode=”\nfor i in range(len(string)):\nk=i%length\ncode+=from<em>char</em>code(ord(string[i])^ord(key[k]))\nresult=base64.b64decode(code).decode(‘utf-8’)\nreturn result</p>\n<p>def write<em>to</em>txt(urls):\nf=open(‘result.txt’,‘w’)\nfor url in urls:\nf.write(url+’\n’)\nf.close()</p>\n<p>def crawl():\nencoded<em>urls=get</em>encoded<em>urls()\nurls=[]\nfor string in encoded</em>urls:\nurl=decode(string)\nurls.append(url)\nwrite<em>to</em>txt(urls)</p>\n<p>crawl()</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"></code></pre></div>","fields":{"slug":"/破解某网站url加密/","prefix":null},"frontmatter":{"title":"","author":null,"category":null,"cover":null}},"authornote":{"id":"f3ffdeef-a16f-507d-9f2f-98fa5e045d0b","html":"<p><strong>Mr. Gatsby</strong> Proin ornare ligula eu tellus tempus elementum. Aenean <a href=\"/\">bibendum</a> iaculis mi, nec blandit lacus interdum vitae. Vestibulum non nibh risus, a scelerisque purus. Blandit lacus interdum vitae. Vestibulum non nibh risus, a scelerisque purus.</p>"},"site":{"siteMetadata":{"facebook":{"appId":""}}}},"pageContext":{"slug":"/破解某网站url加密/","next":{"id":"6ac32379-a385-5861-81c6-af4059a4d2b5","fields":{"slug":"/破解Geetest极验滑动验证码/","prefix":null,"source":"posts"},"frontmatter":{"title":"","category":null}},"source":"posts"}}