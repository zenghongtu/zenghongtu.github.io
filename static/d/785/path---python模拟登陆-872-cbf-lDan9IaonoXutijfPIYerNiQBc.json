{"data":{"post":{"id":"e1cec6c4-7fad-5a2d-8460-3a1eb120fd8b","html":"<p>title: python网络爬虫之模拟登陆\nauthor: 大图\ntags:</p>\n<ul>\n<li>\n<p>python</p>\n</li>\n<li>\n<p>模拟登陆\ncategories:</p>\n</li>\n<li>\n<p>爬虫\ndate: 2017-07-25 14:48:00</p>\n<hr>\n<p>登录有两种方式可以实现，一种是使用cookies登录，一种是模拟提交表单登录。</p>\n</li>\n<li>\n<p>Cookie登录\n首先现在浏览器中登录网站，然后取出登录后的Cookie,添加进请求的header中。</p>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> requests\n\ncookies<span class=\"token operator\">=</span><span class=\"token string\">'xxx'</span>\nres<span class=\"token operator\">=</span>requests<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span>cookies<span class=\"token operator\">=</span>cookies<span class=\"token punctuation\">)</span></code></pre></div>\n<ol start=\"2\">\n<li>POST登录\n这里以登录知乎为例</li>\n</ol>\n<p>首先抓包获取post需要发送的参数</p>\n<p>其中_xsrf是需要从网页中获取的\n获取xsrf</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">session<span class=\"token operator\">=</span>requests<span class=\"token punctuation\">.</span>session<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nhtml<span class=\"token operator\">=</span>session<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'https://www.zhihu.com/'</span><span class=\"token punctuation\">,</span>headers<span class=\"token operator\">=</span>headers<span class=\"token punctuation\">)</span>\nxsrf<span class=\"token operator\">=</span>BeautifulSoup<span class=\"token punctuation\">(</span>html<span class=\"token punctuation\">,</span><span class=\"token string\">'lxml'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>find<span class=\"token punctuation\">(</span><span class=\"token string\">'input'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">{</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'_xsrf'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'value'</span><span class=\"token punctuation\">)</span>\n构造表单\ndata<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>\n<span class=\"token string\">'_xsrf'</span><span class=\"token punctuation\">:</span>xsrf<span class=\"token punctuation\">,</span>\n<span class=\"token string\">'password'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'passwd'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'captcha_type'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'cn'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'remember_me'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'true'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'email'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'email'</span>\n<span class=\"token punctuation\">}</span>\n登录\n<span class=\"token keyword\">import</span> requests\n<span class=\"token keyword\">from</span> bs4 <span class=\"token keyword\">import</span> BeautifulSoup\n\nheaders <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"Accept\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"Accept-Encoding\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"gzip, deflate\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"Accept-Language\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"en-US,en;q=0.5\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"Connection\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"keep-alive\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"User-Agent\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:39.0) Gecko/20100101 Firefox/39.0\"</span><span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">login</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    session<span class=\"token operator\">=</span>requests<span class=\"token punctuation\">.</span>session<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    html<span class=\"token operator\">=</span>session<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'https://www.zhihu.com/'</span><span class=\"token punctuation\">,</span>headers<span class=\"token operator\">=</span>headers<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>text\n    xsrf<span class=\"token operator\">=</span>BeautifulSoup<span class=\"token punctuation\">(</span>html<span class=\"token punctuation\">,</span><span class=\"token string\">'lxml'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>find<span class=\"token punctuation\">(</span><span class=\"token string\">'input'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">{</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'_xsrf'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'value'</span><span class=\"token punctuation\">)</span>\n    data<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>\n    <span class=\"token string\">'_xsrf'</span><span class=\"token punctuation\">:</span>xsrf<span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'password'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'passwd'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'captcha_type'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'cn'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'remember_me'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'true'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'email'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'email'</span>\n    <span class=\"token punctuation\">}</span>\n    html<span class=\"token operator\">=</span>session<span class=\"token punctuation\">.</span>post<span class=\"token punctuation\">(</span><span class=\"token string\">'https://www.zhihu.com/login/email'</span><span class=\"token punctuation\">,</span>headers<span class=\"token operator\">=</span>headers<span class=\"token punctuation\">,</span>data<span class=\"token operator\">=</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>text\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>html<span class=\"token punctuation\">)</span>\n\nlogin<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n登录结果\n<span class=\"token punctuation\">{</span>‘r’<span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> ‘msg’<span class=\"token punctuation\">:</span> ‘登录成功’<span class=\"token punctuation\">}</span></code></pre></div>","fields":{"slug":"/python模拟登陆/","prefix":null},"frontmatter":{"title":"","author":null,"category":null,"cover":null}},"authornote":{"id":"f3ffdeef-a16f-507d-9f2f-98fa5e045d0b","html":"<p><strong>Mr. Gatsby</strong> Proin ornare ligula eu tellus tempus elementum. Aenean <a href=\"/\">bibendum</a> iaculis mi, nec blandit lacus interdum vitae. Vestibulum non nibh risus, a scelerisque purus. Blandit lacus interdum vitae. Vestibulum non nibh risus, a scelerisque purus.</p>"},"site":{"siteMetadata":{"facebook":{"appId":""}}}},"pageContext":{"slug":"/python模拟登陆/","prev":{"id":"b7bebbca-c603-5df5-baf9-40abb5db6450","fields":{"slug":"/python爬虫技能树总结/","prefix":null,"source":"posts"},"frontmatter":{"title":"","category":null}},"next":{"id":"ce3ae192-ec81-5fb0-a979-9f75f6d208c5","fields":{"slug":"/python反爬虫归纳/","prefix":null,"source":"posts"},"frontmatter":{"title":"","category":null}},"source":"posts"}}