{"data":{"post":{"id":"b6db97cf-dd9a-5c81-b16a-90d8f6ce9079","html":"<p>前言：React 的版本从 v15 到 v16.3 ，再到v16.4，现在最新的版本是 v16.8了。其中最大的变化可能是<code class=\"language-text\">React Hooks</code>的加入，而最令人困惑的却是它的生命周期，新旧生命周期函数混杂在一起，难免会让许多新来者有很多困惑。所以这一篇我们来分析一下 React 生命周期的演变及原因，进一步理解其使用。</p>\n<h2>组件生命周期的四个阶段</h2>\n<ol>\n<li>Initialization  （初始化阶段：组件实例的创建）</li>\n<li>Mounting   （加载阶段：组件插入 dom中）</li>\n<li>Updating  （更新阶段：属性或状态每改变一次都将会触发一次，组件重新渲染。）</li>\n<li>Unmounting  （卸载阶段：组件卸载和销毁）</li>\n</ol>\n<h2>老版生命周期（16.3之前的生命周期）</h2>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a35ab94cb7a12e6c1a80c94995cb4151/f01c5/20190218202125505_601165039.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 800px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 126.6897746967071%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAYAAAAxFw7TAAAACXBIWXMAAAsSAAALEgHS3X78AAACHklEQVQ4y6WUi46jMAxF+f9PrDSV2t2qwyukBVr69OSYupuhQGe0kQwhODfX146T+/0uc+N8Pqsx8DX/eB6PhEfTNLLf76UoCinLUrIsU5Dj8ahr2OFweG6aI6GAu91ONy2XS9lsNk9ADlmtVmrMWbtcLvMM505r21YPAwyGvOu6fh+y/YyNweY0TdUM6G3IQ5FjQFjFDKcOfmE4HOZIyOgJQxL334CESdYxWP44y1OAhOm917CZw7LrulnQWUAAnHNqzAGNi/zXgGhopWIaxv/H9EzGhJ4qm9vtNpkQW0vm7jGsLClxHUYwL/c7uV6vQeiTXMOVulzOcjqdvhmghG5NAoNp2x6kfuiKD74aMhqxsM1KSfNefNiYbmTZuVINptz5KiRpvUll/XcrVVXpOoljroDaVVxoEM7rHEYYpwP8GQ7LikpaPWwveZ7r2wcAgADEn2gTakwtMKkqJz7MAbEr530lfwIbQIuykrz0ypDNYwlKCCnLcj3VQgLQ+iBXryhycWWY56Ffup4VOo6Vm4bcdX2YRv9fIR+lCeDbrAoJQIJeCrQaq0VlmBVOPtahAeRlaLAfslgstNHCzBrD56MWkaF5AKI1YQ9vTeJVw1pLACczwu419E89YW2Z59tK5Rtg3+v6UGyD1R7GZsy++QfDqc6jgEMwAzQ2AMRrfFtSXrJMOOY4fGNWVvHaEPAtQ+sylhTeVlYmwbDz2PgCKhWdkMvkgO0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;\"\n        alt=\"React v16.3之前 生命周期\"\n        title=\"\"\n        src=\"/static/a35ab94cb7a12e6c1a80c94995cb4151/b21dd/20190218202125505_601165039.png\"\n        srcset=\"/static/a35ab94cb7a12e6c1a80c94995cb4151/2d451/20190218202125505_601165039.png 200w,\n/static/a35ab94cb7a12e6c1a80c94995cb4151/06807/20190218202125505_601165039.png 400w,\n/static/a35ab94cb7a12e6c1a80c94995cb4151/b21dd/20190218202125505_601165039.png 800w,\n/static/a35ab94cb7a12e6c1a80c94995cb4151/f01c5/20190218202125505_601165039.png 1154w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h3>Initialization  （初始化阶段：涉及4个钩子函数）</h3>\n<p>这些方法会在组件初始化的时候被调用，只跟实例的创建有关。\n如果用<code class=\"language-text\">createReactClass</code>进行创建，则还有<code class=\"language-text\">getInitialState</code>这些生命周期函数，但很少使用，我们这里不提及。</p>\n<h4>static defaultProps{} （getDefaultProps()）</h4>\n<p>定义默认<code class=\"language-text\">props</code>，会和父组件传下来的<code class=\"language-text\">props</code>进行合并，且以父组件中的<code class=\"language-text\">props</code>优先级更高，相当于<code class=\"language-text\">{...defaultProps, props}</code>。</p>\n<h4>static propTypes{} （getInitialState()）</h4>\n<p>定义<code class=\"language-text\">props</code>的数据类型，可以帮助我们确定其有效性，减少许多开发中不必要的错误。</p>\n<h4>constructor()</h4>\n<p>在加载阶段前调用一次，进行 state 的初始化。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">super(props)</code>用来调用父类的构建方法。</p>\n<h3>Mounting   （加载阶段：涉及3个钩子函数）</h3>\n<h4>componentWillMount()</h4>\n<p>新版中为<code class=\"language-text\">UNSAFE_componentWillMount()</code>。</p>\n<p>只在组件加载时调用，整个生命周期只调用一次，以后组件更新也不会调用，此时可以修改 state。</p>\n<h4>render()</h4>\n<p><code class=\"language-text\">react</code> 中最重要的生命周期函数，创建虚拟 dom，并进行 <code class=\"language-text\">diff</code> 算法，更新 dom 树也在此进行。所以不应该在此改变组件的状态或者与浏览器进行交互。</p>\n<p><strong>注意：</strong>这个函数不能缺少，如果不创建虚拟 dom，可以<code class=\"language-text\">return null</code>。</p>\n<h4>componentDidMount()</h4>\n<p>组件加载完成后立即调用，整个生命周期只调用一次，可以获取到更新后的 DOM，在此处可以进行网络请求等。</p>\n<h3>Updating  （更新阶段：涉及5个钩子函数）</h3>\n<h4>componentWillReceiveProps()</h4>\n<p>新版中为<code class=\"language-text\">UNSAFE_componentWillReceiveProps()</code>。</p>\n<p>在组件加载后，如果有新的<code class=\"language-text\">props</code>传递过来，会先调用这个函数，可以在这里调用<code class=\"language-text\">setState()</code>修改<code class=\"language-text\">state</code>。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">componentWillReceiveProps</span><span class=\"token punctuation\">(</span>nextProps<span class=\"token punctuation\">)</span></code></pre></div>\n<h4>shouldComponentUpdate()</h4>\n<p><code class=\"language-text\">react</code>中一个重要的性能优化点，组件接收到新的<code class=\"language-text\">props</code>或者<code class=\"language-text\">state</code>，返回<code class=\"language-text\">true</code>表示需要更新 dom，返回<code class=\"language-text\">false</code>阻止更新。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">shouldComponentUpdate</span><span class=\"token punctuation\">(</span>nextProps<span class=\"token punctuation\">,</span> nextState<span class=\"token punctuation\">)</span></code></pre></div>\n<h4>componentWillUpdate()</h4>\n<p>新版中为<code class=\"language-text\">UNSAFE_componentWillUpdate()</code>。</p>\n<p>组件加载时不调用，只有在组件需要更新（即<code class=\"language-text\">shouldComponentUpdate</code>返回<code class=\"language-text\">true</code>）时调用。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">componentWillUpdate</span><span class=\"token punctuation\">(</span>nextProps<span class=\"token punctuation\">,</span> nextState<span class=\"token punctuation\">)</span></code></pre></div>\n<p><strong>注意</strong>：不能在这个方法中调用<code class=\"language-text\">setState()</code>修改<code class=\"language-text\">state</code>。</p>\n<h4>render()</h4>\n<p>同上。</p>\n<h4>componentDidUpdate()</h4>\n<p>在组件更新完成后立即被调用，可以进行网络请求等。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">componentDidUpdate</span><span class=\"token punctuation\">(</span>prevProps<span class=\"token punctuation\">,</span> prevState<span class=\"token punctuation\">)</span></code></pre></div>\n<h3>Unmounting  （卸载阶段：涉及1个钩子函数）</h3>\n<h4>componentWillUnmount()</h4>\n<p>在组件被卸载和销毁之前调用，可以在这里处理任何必要的清理工作，比如解除定时器，取消已经发起的网络请求，清理在<code class=\"language-text\">componentDidMount</code>函数中创建的 DOM 元素。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">componentWillUnmount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3>Error Handling（错误处理：涉及1个钩子函数）</h3>\n<h4>componentDidCatch()</h4>\n<p>错误边界捕获，在v16.0刚推出的时候新增加的一个生命周期函数，用于捕获在<strong>子组件树</strong>中任意地方发生的 JavaScript 错误，一个错误边界不能捕获它自己内部的错误。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">componentDidCatch</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">,</span> info<span class=\"token punctuation\">)</span></code></pre></div>\n<h3>组件的基本写法</h3>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> React<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>Component<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'React'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">OldReactComponent</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Componet</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">static</span> defaultProps<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">static</span> propTypes<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    state<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token function\">componentWillMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">componentDidMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token function\">componentWillReceivePorps</span><span class=\"token punctuation\">(</span>nextProps<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token function\">componentShouldUpdate</span><span class=\"token punctuation\">(</span>nextProps<span class=\"token punctuation\">,</span>nextState<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">componentWillUpdate</span><span class=\"token punctuation\">(</span>nextProps<span class=\"token punctuation\">,</span>nextState<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token function\">componentDidUpdate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token function\">componentWillUnmount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>新版生命周期（16.4之后的生命周期）</h2>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/54f619e208fce4142c08417841ef04b3/4ec34/20190219170613371_1692935879.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 800px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 107.7896138482024%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAAAsSAAALEgHS3X78AAACEUlEQVQ4y41Vi5KCMAzk/z/ybjwVoZTSUnmoaK4bCFYE75jJ0Np22d0kNaGV5/F4zG8Z3243ul6vq/viJ8Gmtm2prmvy3vPBJdgwDJSmKUff9y9rS9DkfD6TUooOhwMVRTGziA/ht6qqyFpLTdMQztzv93XAT5LlAWutNUfXdW+2vAAKkzhk4+VyYYkAAUMEGMKCLdAklhcDQhKkOeeoLEtmhzdiyfKj5BgQnhljGBhjRO1rTiJYLkn8CSgMIRPv2gWwpuU5WK5K3vIQgCgl+AZgjI/Zgfann8CwoS2rVrMsgM49AeFdXuRUuYrarqWt6khQEgj25D7QEM37IAtgkAiGCIyx3l/QEB3XKKphZojuQGBzpgy58AaILi1VdhzP2Z5q0ZiSlDaUZoqZI3HAQIMkUvk+RJrpkEVPXciiNpbKEC2vN3zgGNYr59kGZBpe4jwCFiESPxmvQ9tpXXD7YQ65YF3w7yMzV0PN6Ocwtd5bHcqlID6JxJl5WEP9jXvOc4LibokjkcKVWhNwBJjGXaKDb0pX7OEScJUhAPb7Pe12OwYZ2fpQLoblyoesdbwW30wvgHFpQB6AwVakxlZIG6J0Vlvv6U/zFgKGD2AsH8Z8eePMgPBQCjZmIQchXRWKcpUF2W6SbLc9xKIArDFsQg2eVErfxy9uu38x5Gtpai0JeAh2eZ5zLZZ6vAvF362/gF8u9bEQ89XzKQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;\"\n        alt=\"React v16\"\n        title=\"\"\n        src=\"/static/54f619e208fce4142c08417841ef04b3/b21dd/20190219170613371_1692935879.png\"\n        srcset=\"/static/54f619e208fce4142c08417841ef04b3/2d451/20190219170613371_1692935879.png 200w,\n/static/54f619e208fce4142c08417841ef04b3/06807/20190219170613371_1692935879.png 400w,\n/static/54f619e208fce4142c08417841ef04b3/b21dd/20190219170613371_1692935879.png 800w,\n/static/54f619e208fce4142c08417841ef04b3/c9309/20190219170613371_1692935879.png 1200w,\n/static/54f619e208fce4142c08417841ef04b3/4ec34/20190219170613371_1692935879.png 1502w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    \n（带<code class=\"language-text\">UNSAFE_</code>的函数在以后将会被丢弃，官方也不建议使用，这里不再列出。）</p>\n<p>新版本中，新增了三个生命周期函数：</p>\n<ul>\n<li>static getDerivedStateFromProps() </li>\n<li>getSnapshotBeforeUpdate</li>\n<li>static getDerivedStateFromError()</li>\n</ul>\n<p>同时deprecate了一组生命周期API，包括：</p>\n<ul>\n<li>componentWillReceiveProps</li>\n<li>componentWillMount</li>\n<li>componentWillUpdate</li>\n</ul>\n<p>可以看出除了<code class=\"language-text\">shouldComponentUpdate</code>之外，<code class=\"language-text\">render</code> 之前的所有生命周期都被消灭了。原因是这些生命周期太多时候没有被正确使用，而且在<code class=\"language-text\">Fiber</code>之后，<strong>如果要开启<code class=\"language-text\">async rendering</code>，在<code class=\"language-text\">render</code>函数之前的所有函数，都有可能被执行多次。</strong></p>\n<h3>Initialization  （初始化阶段：涉及4个钩子函数）</h3>\n<p>同上。</p>\n<h3>Mounting   （加载阶段：涉及3个钩子函数）</h3>\n<h4>static getDerivedStateFromProps()</h4>\n<p>因为是静态方法，所以无法访问到组件实例。每次组件调用<code class=\"language-text\">render</code>前都会被调用，获取新的<code class=\"language-text\">props</code>和<code class=\"language-text\">state</code>（v16.3只会为<code class=\"language-text\">props</code>的而调用，v16.4修正为<code class=\"language-text\">props</code>和<code class=\"language-text\">state</code>)之后，返回一个对象作为新的<code class=\"language-text\">state</code>，如果返回<code class=\"language-text\">null</code>则表示不需要更新；配合componentDidUpdate，可以覆盖componentWillReceiveProps的所有用法。并且它应该是个纯函数，没有副作用(side effect)。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">static</span> <span class=\"token function\">getDerivedStateFromProps</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">,</span>state<span class=\"token punctuation\">)</span></code></pre></div>\n<h4>render()</h4>\n<p>同上。</p>\n<h4>componentDidMount()</h4>\n<p>同上。</p>\n<h3>Updating  （更新阶段：涉及5个钩子函数）</h3>\n<h4>static getDerivedStateFromProps()</h4>\n<p>同上。</p>\n<h4>shouldComponentUpdate()</h4>\n<p>同上。</p>\n<h4>render()</h4>\n<p>同上。</p>\n<h4>getSnapshotBeforeUpdate()</h4>\n<p>触发时间: update发生的时候，在render之后，在组件dom渲染之前；返回一个值，作为componentDidUpdate的第三个参数；配合componentDidUpdate, 可以覆盖componentWillUpdate的所有用法，常用于 scroll 位置的定位。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">getSnapshotBeforeUpdate</span><span class=\"token punctuation\">(</span>prevProps<span class=\"token punctuation\">,</span> prevState<span class=\"token punctuation\">)</span></code></pre></div>\n<h4>componentDidUpdate()</h4>\n<p>同上。</p>\n<h3>Unmounting  （卸载阶段：涉及1个钩子函数）</h3>\n<h4>componentWillUnmount()</h4>\n<p>同上。</p>\n<h3>Error Handling（错误处理：涉及2个钩子函数）</h3>\n<h4>componentDidCatch()</h4>\n<p>同上。</p>\n<h4>static getDerivedStateFromError()</h4>\n<p> 用于在“render”阶段（非<code class=\"language-text\">render</code>函数）的错误捕获，应该是个纯函数，没有副作用(side effect)。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">static</span> <span class=\"token function\">getDerivedStateFromError</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span></code></pre></div>\n<h3>组件的基本写法</h3>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> React<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>Component<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'React'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">OldReactComponent</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Componet</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">static</span> defaultProps<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">static</span> propTypes<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    state<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">static</span> <span class=\"token function\">getDerivedStateFromProps</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">,</span>state<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">componentDidMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token function\">componentShouldUpdate</span><span class=\"token punctuation\">(</span>nextProps<span class=\"token punctuation\">,</span>nextState<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">getSnapshotBeforeUpdate</span><span class=\"token punctuation\">(</span>prevProps<span class=\"token punctuation\">,</span> prevState<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token function\">componentDidUpdate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token function\">componentWillUnmount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>总结</h2>\n<ol>\n<li>\n<p>React新的生命周期新增<code class=\"language-text\">static getDerivedStateFromProps</code>、<code class=\"language-text\">getSnapshotBeforeUpdate</code>并弃用<code class=\"language-text\">componentWillMount</code>，<code class=\"language-text\">componentWillReceiveProps</code>，<code class=\"language-text\">componetWillUpdate</code>（这三个函数将在 React 17中删除）。</p>\n</li>\n<li>\n<p>新增<code class=\"language-text\">static getDerivedStateFromError</code>捕获“render”阶段的错误。</p>\n</li>\n</ol>\n<h2>参考</h2>\n<blockquote>\n<p><a href=\"https://segmentfault.com/a/1190000017175195\">帮你理清React的生命周期</a></p>\n</blockquote>\n<blockquote>\n<p><a href=\"https://segmentfault.com/a/1190000016617400\">React-新的生命周期（React16版本）</a></p>\n</blockquote>\n<blockquote>\n<p><a href=\"https://zhuanlan.zhihu.com/p/38030418\">React v16.3之后的组件生命周期函数</a></p>\n</blockquote>","fields":{"slug":"/捋一捋React的生命周期/","prefix":"2019-02-20"},"frontmatter":{"title":"捋一捋React的生命周期","author":"Jason Zeng","category":"React","cover":{"childImageSharp":{"resize":{"src":"/static/c401a1424b2eec7f571b4df4f4197539/ada8c/photo-1451187580459-43490279c0fa.jpeg"}}}}},"authornote":{"id":"eeaf3f36-861e-5339-a4a4-e63a63ccd23c","html":"<p><a href=\"https://github.com/zenghongtu\">Jason Zeng</a></p>"},"site":{"siteMetadata":{"facebook":{"appId":"2349655921921608"}}}},"pageContext":{"slug":"/捋一捋React的生命周期/","prev":{"id":"7e980257-d35d-5a70-9ef3-984c8d84cca9","fields":{"slug":"/使用Gatsby.js快速搭建静态博客并通过Travis CI轻松实现自动构建/","prefix":"2019-02-18","source":"posts"},"frontmatter":{"title":"使用Gatsby.js快速搭建静态博客并通过Travis CI轻松实现自动构建","category":"Gatsby"}},"next":{"id":"cc9a4c18-8291-5599-a1fd-04fae7330cd9","fields":{"slug":"/快速了解react-hooks/","prefix":"2019-02-21","source":"posts"},"frontmatter":{"title":"快速了解react-hooks","category":"react"}},"source":"posts"}}